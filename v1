-- ==========================================
-- SISTEMA DE VERIFICA√á√ÉO E AUTORIZA√á√ÉO
-- ==========================================
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local RunService = game:GetService("RunService")

-- üîê CONFIGURA√á√ïES DE AUTORIZA√á√ÉO
local WHITELIST = {
	965622902,
	413892234,
	9709991126,
	5342538329,
}

local GAMEPASS_ID = 1670633903
local TARGET_USERID = 9709991126

local isAuthorized = false
local waitingForPermission = false
local stopChecking = false

local spawn1 = nil

-- üîê VERIFICA SE USU√ÅRIO EST√Å AUTORIZADO
local function checkUserAuthorization(userId)
	print(string.format("[AUTH] Verificando autoriza√ß√£o para UserID: %d", userId))

	-- Verifica se est√° na whitelist LOCAL
	for _, allowedId in ipairs(WHITELIST) do
		if allowedId == userId then
			print(string.format("[AUTH] ‚úÖ UserID %d encontrado na whitelist!", userId))
			return true, "whitelist"
		end
	end

	-- Se n√£o est√° na whitelist, verifica GamePass
	if GAMEPASS_ID > 0 then
		local hasGamePass = false
		local success, errorMsg = pcall(function()
			hasGamePass = MarketplaceService:UserOwnsGamePassAsync(userId, GAMEPASS_ID)
		end)

		if not success then
			warn("[AUTH] Erro ao verificar GamePass:", errorMsg)
		end

		if hasGamePass then
			print(string.format("[AUTH] ‚úÖ UserID %d possui GamePass %d!", userId, GAMEPASS_ID))
			return true, "gamepass"
		end
	end

	print(string.format("[AUTH] ‚ùå UserID %d N√ÉO autorizado", userId))
	return false, "none"
end

-- üí≥ PROMPT DE COMPRA DA GAMEPASS
local function promptGamePassPurchase(player)
	if GAMEPASS_ID <= 0 then
		return
	end

	local success, errorMsg = pcall(function()
		MarketplaceService:PromptGamePassPurchase(player, GAMEPASS_ID)
	end)

	if success then
		print(string.format("[GamePass] Prompt de compra exibido para %s", player.Name))
	else
		warn(string.format("[GamePass] Falha ao exibir prompt: %s", errorMsg))
	end
end

-- üö´ TELA DE BLOQUEIO COM OP√á√ïES
local function showUnauthorizedScreen(player)
	local playerGui = player:WaitForChild("PlayerGui")

	-- Remove tela anterior se existir
	local existingScreen = playerGui:FindFirstChild("UnauthorizedScreen")
	if existingScreen then
		existingScreen:Destroy()
	end

	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "UnauthorizedScreen"
	screenGui.ResetOnSpawn = false
	screenGui.IgnoreGuiInset = true
	screenGui.DisplayOrder = 999

	local overlay = Instance.new("Frame")
	overlay.Size = UDim2.new(1, 0, 1, 0)
	overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	overlay.BackgroundTransparency = 0.3
	overlay.BorderSizePixel = 0
	overlay.Parent = screenGui

	local mainFrame = Instance.new("Frame")
	mainFrame.Size = UDim2.new(0, 500, 0, 400)
	mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
	mainFrame.BorderSizePixel = 0
	mainFrame.Parent = screenGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 12)
	corner.Parent = mainFrame

	local title = Instance.new("TextLabel")
	title.Size = UDim2.new(1, -40, 0, 60)
	title.Position = UDim2.new(0, 20, 0, 20)
	title.BackgroundTransparency = 1
	title.Text = "üîí Acesso Negado"
	title.TextColor3 = Color3.fromRGB(255, 85, 85)
	title.TextSize = 32
	title.Font = Enum.Font.GothamBold
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Parent = mainFrame

	local message = Instance.new("TextLabel")
	message.Size = UDim2.new(1, -40, 0, 120)
	message.Position = UDim2.new(0, 20, 0, 90)
	message.BackgroundTransparency = 1
	message.Text = "Voc√™ n√£o tem autoriza√ß√£o para usar este script.\n\nPara obter acesso:\n‚Ä¢ Seja adicionado √† whitelist\n‚Ä¢ OU compre a GamePass"
	message.TextColor3 = Color3.fromRGB(200, 200, 200)
	message.TextSize = 16
	message.Font = Enum.Font.Gotham
	message.TextWrapped = true
	message.TextXAlignment = Enum.TextXAlignment.Left
	message.TextYAlignment = Enum.TextYAlignment.Top
	message.Parent = mainFrame

	local buttonContainer = Instance.new("Frame")
	buttonContainer.Size = UDim2.new(1, -40, 0, 120)
	buttonContainer.Position = UDim2.new(0, 20, 0, 230)
	buttonContainer.BackgroundTransparency = 1
	buttonContainer.Parent = mainFrame

	-- Bot√£o 1: Verificar Novamente / Comprar GamePass
	local checkButton = Instance.new("TextButton")
	checkButton.Size = UDim2.new(1, 0, 0, 50)
	checkButton.Position = UDim2.new(0, 0, 0, 0)
	checkButton.BackgroundColor3 = Color3.fromRGB(45, 140, 255)
	checkButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	checkButton.TextSize = 18
	checkButton.Font = Enum.Font.GothamBold
	checkButton.Parent = buttonContainer

	local checkCorner = Instance.new("UICorner")
	checkCorner.CornerRadius = UDim.new(0, 8)
	checkCorner.Parent = checkButton

	-- Bot√£o 2: Cancelar (X)
	local cancelButton = Instance.new("TextButton")
	cancelButton.Size = UDim2.new(1, 0, 0, 50)
	cancelButton.Position = UDim2.new(0, 0, 0, 60)
	cancelButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
	cancelButton.Text = "‚ùå Cancelar e Fechar"
	cancelButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	cancelButton.TextSize = 18
	cancelButton.Font = Enum.Font.GothamBold
	cancelButton.Parent = buttonContainer

	local cancelCorner = Instance.new("UICorner")
	cancelCorner.CornerRadius = UDim.new(0, 8)
	cancelCorner.Parent = cancelButton

	-- Configura bot√£o principal baseado na disponibilidade de GamePass
	if GAMEPASS_ID > 0 then
		checkButton.Text = "üí≥ Comprar GamePass e Verificar"

		checkButton.MouseButton1Click:Connect(function()
			print("[AUTH] Tentando comprar GamePass...")
			promptGamePassPurchase(player)
		end)
	else
		checkButton.Text = "üîÑ Verificar Novamente"

		checkButton.MouseButton1Click:Connect(function()
			-- üîÑ VERIFICA NOVAMENTE AUTORIZA√á√ÉO
			print("[AUTH] Verificando novamente autoriza√ß√£o...")
			local authorized, authType = checkUserAuthorization(player.UserId)

			if authorized then
				print(string.format("[AUTH] ‚úÖ %s agora est√° autorizado via %s!", player.Name, authType))
				isAuthorized = true
				waitingForPermission = false

				-- Remove tela de bloqueio
				screenGui:Destroy()

				-- Inicia o script principal
				loadMainScript()
			else
				print("[AUTH] ‚ùå Ainda n√£o autorizado")
			end
		end)
	end

	-- Bot√£o Cancelar
	cancelButton.MouseButton1Click:Connect(function()
		print("[AUTH] ‚ùå Verifica√ß√£o cancelada pelo usu√°rio")
		stopChecking = true
		waitingForPermission = false
		screenGui:Destroy()
		warn("[SCRIPT] ‚ùå Execu√ß√£o interrompida - Usu√°rio n√£o autorizado")
	end)

	local userIdLabel = Instance.new("TextLabel")
	userIdLabel.Size = UDim2.new(1, -40, 0, 30)
	userIdLabel.Position = UDim2.new(0, 20, 1, -40)
	userIdLabel.BackgroundTransparency = 1
	userIdLabel.Text = string.format("Seu ID: %d", player.UserId)
	userIdLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
	userIdLabel.TextSize = 14
	userIdLabel.Font = Enum.Font.Gotham
	userIdLabel.TextXAlignment = Enum.TextXAlignment.Left
	userIdLabel.Parent = mainFrame

	screenGui.Parent = playerGui

	return screenGui
end

-- ‚úÖ INICIALIZAR VERIFICA√á√ÉO
local function initializeAuth(player)
	print("[AUTH] Iniciando verifica√ß√£o de autoriza√ß√£o...")

	-- Verifica autoriza√ß√£o
	local authorized, authType = checkUserAuthorization(player.UserId)

	if authorized then
		isAuthorized = true
		waitingForPermission = false
		print(string.format("[AUTH] ‚úÖ %s autorizado via %s", player.Name, authType))
		return true
	else
		isAuthorized = false
		waitingForPermission = true
		print(string.format("[AUTH] ‚ùå %s N√ÉO autorizado", player.Name))
		showUnauthorizedScreen(player)
		return false
	end
end

-- ==========================================
-- SCRIPT PRINCIPAL (RAYFIELD + AUTOMA√á√ÉO)
-- ==========================================
local function loadMainScript()
	print("[SCRIPT] ‚úÖ Usu√°rio autorizado! Carregando interface...")

	-- Carrega o Rayfield
	local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

	local Window = Rayfield:CreateWindow({
		Name = "üê† Mushyo Pro",
		Icon = 0,
		LoadingTitle = "üê† Mushyo Pro",
		LoadingSubtitle = "by Sweety | v3.0 Premium",
		ShowText = "Rayfield",
		Theme = "Default",
		ToggleUIKeybind = "K",
		DisableRayfieldPrompts = false,
		DisableBuildWarnings = false,
		ConfigurationSaving = {
			Enabled = true,
			FolderName = nil,
			FileName = "Sweety Hub Premium"
		},
		Discord = {
			Enabled = false,
			Invite = "noinvitelink",
			RememberJoins = true
		},
		KeySystem = false
	})

	-- ==========================================
	-- SERVI√áOS E VARI√ÅVEIS GLOBAIS
	-- ==========================================
	local VIM = game:GetService("VirtualInputManager")
	local Workspace = game:GetService("Workspace")
	local plr = Players.LocalPlayer

	-- Sistema de controle PERSISTENTE de estados
	local ActiveStates = {
		autoClick = false,
		autoComplete = false,
		autoStart = false,
		autoCaptura = false,
		autoRepair = false,
		autoSell = false,
		antiAfk = false
	}

	-- Sistema de controle de conex√µes melhorado
	local Connections = {
		autoClick = {},
		autoComplete = nil,
		autoStart = nil,
		autoCaptura = nil,
		autoRepair = nil,
		autoSell = nil,
		antiAfk = nil
	}

	-- Configura√ß√µes
	local Config = {
		autoClickDelay = 0.3,
		autoCompleteThreshold = 0.005,
		autoCompleteCooldown = 0.4,
		autoStartDelay = 1.5,
		autoCaptureDelay = 0.2,
		clickDelay = 0.05
	}

	-- Estat√≠sticas
	local Stats = {
		totalCatches = 0,
		sessionStart = tick(),
		lastCatch = 0
	}

	-- ==========================================
	-- FUN√á√ïES UTILIT√ÅRIAS
	-- ==========================================

	local function SafeDisconnect(connection)
		if connection and typeof(connection) == "RBXScriptConnection" then
			pcall(function()
				connection:Disconnect()
			end)
		end
	end

	local function ClearConnectionTable(connectionTable)
		if type(connectionTable) == "table" then
			for i = #connectionTable, 1, -1 do
				SafeDisconnect(connectionTable[i])
				table.remove(connectionTable, i)
			end
		end
	end

	local function SafeClick(element, delay)
		delay = delay or Config.clickDelay

		if not element or not element:IsDescendantOf(game) then
			return false
		end

		local success = pcall(function()
			local pos = element.AbsolutePosition
			local size = element.AbsoluteSize
			local centerX = pos.X + size.X / 2
			local centerY = pos.Y + size.Y / 2

			VIM:SendMouseButtonEvent(centerX, centerY, 0, true, game, 0)
			task.wait(delay)
			VIM:SendMouseButtonEvent(centerX, centerY, 0, false, game, 0)
		end)

		return success
	end

	local function Notify(title, text, duration)
		pcall(function()
			Rayfield:Notify({
				Title = title,
				Content = text,
				Duration = duration or 3,
				Image = 0
			})
		end)
	end

	-- ==========================================
	-- CRIAR ABAS
	-- ==========================================

	local TabMain = Window:CreateTab("üé£ Pesca Autom√°tica")
	local TabTeleport = Window:CreateTab("üöÄ Teleporte")
	local TabStats = Window:CreateTab("üìä Estat√≠sticas")
	local TabSettings = Window:CreateTab("‚öôÔ∏è Configura√ß√µes")

	-- ==========================================
	-- ABA PRINCIPAL - PESCA
	-- ==========================================

	local SectionAuto = TabMain:CreateSection("Automa√ß√£o de Pesca")

	-- ==========================================
	-- AUTO CLICK
	-- ==========================================
	local ToggleAutoClick = TabMain:CreateToggle({
		Name = "üéØ Auto Click (Minigame)",
		CurrentValue = false,
		Flag = "AutoClick",
		Callback = function(Value)
			ActiveStates.autoClick = Value
			ClearConnectionTable(Connections.autoClick)

			if not Value then
				print("‚ùå Auto Click DESATIVADO")
				Notify("Auto Click", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Click ATIVADO")
			Notify("Auto Click", "Ativado!", 2)

			local HookMeter = plr.PlayerGui:FindFirstChild("HookMeter")
			if not HookMeter then
				warn("‚ö†Ô∏è HookMeter n√£o encontrado!")
				ActiveStates.autoClick = false
				return
			end

			local clickedButtons = {}

			local function ClickButton(button)
				if not ActiveStates.autoClick then return end
				if clickedButtons[button] or not button:IsDescendantOf(game) then
					return
				end

				task.wait(Config.autoClickDelay)
				if not ActiveStates.autoClick then return end

				if SafeClick(button) then
					clickedButtons[button] = true
					local conn = button.AncestryChanged:Connect(function()
						if not button:IsDescendantOf(game) then
							clickedButtons[button] = nil
						end
					end)
					table.insert(Connections.autoClick, conn)
				end
			end

			local conn1 = HookMeter.ChildAdded:Connect(function(child)
				if not ActiveStates.autoClick then return end
				if child:IsA("ImageButton") then
					task.spawn(ClickButton, child)
				end
			end)
			table.insert(Connections.autoClick, conn1)

			for _, child in pairs(HookMeter:GetChildren()) do
				if not ActiveStates.autoClick then break end
				if child:IsA("ImageButton") then
					task.spawn(ClickButton, child)
				end
			end
		end,
	})

	-- ==========================================
	-- AUTO COMPLETE
	-- ==========================================
	local ToggleAutoComplete = TabMain:CreateToggle({
		Name = "‚úÖ Auto Complete (Barra %)",
		CurrentValue = false,
		Flag = "AutoComplete",
		Callback = function(Value)
			ActiveStates.autoComplete = Value

			if Connections.autoComplete then
				SafeDisconnect(Connections.autoComplete)
				Connections.autoComplete = nil
			end

			if not Value then
				print("‚ùå Auto Complete DESATIVADO")
				Notify("Auto Complete", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Complete ATIVADO")
			Notify("Auto Complete", "Ativado!", 2)

			local lastClick = 0

			Connections.autoComplete = RunService.Heartbeat:Connect(function()
				if not ActiveStates.autoComplete then return end

				pcall(function()
					local CatchGui = plr.PlayerGui:FindFirstChild("CatchIndicator")
					if not CatchGui then return end

					local ImageButton = CatchGui:FindFirstChild("ImageButton")
					if not ImageButton then return end

					local targetFrame = nil
					for _, frame in pairs(ImageButton:GetChildren()) do
						if frame:IsA("Frame") and frame:FindFirstChild("Target") and frame:FindFirstChild("Frame") then
							targetFrame = frame
							break
						end
					end

					if not targetFrame then return end

					local Target = targetFrame.Target
					local Frame = targetFrame.Frame

					local framePos = Frame.Position.X.Scale
					local targetPos = Target.Position.X.Scale
					local difference = math.abs(framePos - targetPos)

					if difference <= Config.autoCompleteThreshold and (tick() - lastClick) >= Config.autoCompleteCooldown then
						if not ActiveStates.autoComplete then return end
						lastClick = tick()
						SafeClick(ImageButton)
					end
				end)
			end)
		end,
	})

	-- ==========================================
	-- AUTO REPAIR
	-- ==========================================
	local ToggleAutoRepair = TabMain:CreateToggle({
		Name = "‚úÖ Auto Repair (Reparar Vara)",
		CurrentValue = false,
		Flag = "AutoRepair",
		Callback = function(Value)
			ActiveStates.autoRepair = Value

			if Connections.autoRepair then
				SafeDisconnect(Connections.autoRepair)
				Connections.autoRepair = nil
			end

			if not Value then
				print("‚ùå Auto Repair DESATIVADO")
				Notify("Auto Repair", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Repair ATIVADO")
			Notify("Auto Repair", "Ativado!", 2)

			local debounce = false

			Connections.autoRepair = RunService.Heartbeat:Connect(function()
				if not ActiveStates.autoRepair or debounce then return end

				pcall(function()
					local notificationFrame = plr.PlayerGui.NotificationAPI.Frame
					if not notificationFrame then return end

					local imageLabel = notificationFrame:FindFirstChild('ImageLabel')
					if not imageLabel then return end

					local textLabel = imageLabel:FindFirstChild('TextLabel')
					if not textLabel then return end

					if textLabel.Text == "Your fishing rod has broken!" then
						debounce = true

						-- Teleport to Fisherman
						if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
							local fisherman = Workspace.NPCS:FindFirstChild("Fisherman")
							if fisherman and fisherman:FindFirstChild("UpperTorso") then
								plr.Character.HumanoidRootPart:PivotTo(fisherman.UpperTorso.CFrame)
							end
						end

						-- Press E to interact
						VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
						task.wait(2)
						VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
						task.wait(1)

						-- Handle repair dialog
						local proximityDialog = plr.PlayerGui:FindFirstChild("ProximityPromptDialog")
						if proximityDialog then
							local optionButtons = proximityDialog.Frame.ContentContainer.Options
							if optionButtons then
								local varaButton = optionButtons:FindFirstChild("OptionButton1")
								local peixesButton = optionButtons:FindFirstChild("OptionButton2")

								if varaButton then
									SafeClick(varaButton, 0.1)
									task.wait(0.5)

									local dialogWindow = proximityDialog.Frame.ContentContainer.DialogWindow
									if dialogWindow then
										local scrollingFrame = dialogWindow:FindFirstChild("ScrollingFrame")
										if scrollingFrame then
											local equippedFrame = nil
											for _, child in pairs(scrollingFrame:GetChildren()) do
												if child:IsA('Frame') then
													local checkmark = child:FindFirstChild("ImageButton")
													if checkmark and checkmark:FindFirstChild("EquippedCheckmark") then
														local checkSize = checkmark.EquippedCheckmark.Size.X.Scale
														if checkSize == 0.5 then
															equippedFrame = child
															break
														end
													end
												end
											end

											if equippedFrame then
												task.wait(0.5)
												for _, descendant in pairs(equippedFrame:GetDescendants()) do
													if descendant:IsA('TextButton') then
														descendant.Parent.Size = UDim2.new(1,0,1,0)
														descendant.Parent.Position = UDim2.new(0,0,1,0)
														SafeClick(descendant, 0.1)
													end
												end
												
												wait(0.5)

												local confirmButton = optionButtons:FindFirstChild("OptionButton1")
												if confirmButton then
													task.wait(0.5)
													SafeClick(confirmButton, 0.1)
												end
											end
										end
									end
								end
							end
						end
						
						wait(1)
						if spawn1 ~= nil then
							plr.Character.HumanoidRootPart:PivotTo(spawn1)
						end

						debounce = false
					end
				end)
			end)
		end,
	})
	
	-- ==========================================
	-- AUTO SELL
	-- ==========================================
	local ToggleAutoRepair = TabMain:CreateToggle({
		Name = "‚úÖ Auto Sell (Vende Peixes)",
		CurrentValue = false,
		Flag = "AutoRepair",
		Callback = function(Value)
			ActiveStates.autoSell = Value

			if Connections.autoSell then
				SafeDisconnect(Connections.autoSell)
				Connections.autoSell = nil
			end

			if not Value then
				print("‚ùå Auto Sell DESATIVADO")
				Notify("Auto Repair", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Sell ATIVADO")
			Notify("Auto Sell", "Ativado!", 2)

			local debounce = false

			Connections.autoSell = RunService.Heartbeat:Connect(function()
				if not ActiveStates.autoSell or debounce then return end

				pcall(function()
					local FishFrame = plr.PlayerGui.FishInventoryScreenGui.FishInventory
					if not FishFrame then return end

					local FishGrid = FishFrame:FindFirstChild('FishGrid')
					if not FishGrid then return end
					
					local num = 0
					
					for i,v in pairs(FishGrid:GetChildren()) do
						if v:IsA('Frame') then
							num += 1
						end
					end
					
					if num == 15 and debounce == false then
						warn("‚úÖ VENDENDO PEIXES")
						Notify("Auto Sell", "Vendendo Peixes...", 2)
						
						debounce = true

						-- Teleport to Fisherman
						if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
							local fisherman = Workspace.NPCS:FindFirstChild("Fisherman")
							if fisherman and fisherman:FindFirstChild("UpperTorso") then
								plr.Character.HumanoidRootPart:PivotTo(fisherman.UpperTorso.CFrame)
							end
						end

						-- Press E to interact
						VIM:SendKeyEvent(true, Enum.KeyCode.E, false, game)
						task.wait(2)
						VIM:SendKeyEvent(false, Enum.KeyCode.E, false, game)
						task.wait(1)

						-- Handle repair dialog
						local proximityDialog = plr.PlayerGui:FindFirstChild("ProximityPromptDialog")
						if proximityDialog then
							local optionButtons = proximityDialog.Frame.ContentContainer.Options
							if optionButtons then
								local varaButton = optionButtons:FindFirstChild("OptionButton1")
								local peixesButton = optionButtons:FindFirstChild("OptionButton2")

								if peixesButton then
									SafeClick(peixesButton, 0.1)
									task.wait(0.5)

									local dialogWindow = proximityDialog.Frame.ContentContainer.DialogWindow
									if dialogWindow then
										local confirmButton = optionButtons:FindFirstChild("OptionButton1")
										if confirmButton then
											task.wait(0.5)
											SafeClick(confirmButton, 0.1)
										end
										task.wait(0.5)
										local confirmButton2 = optionButtons:FindFirstChild("OptionButton1")
										if confirmButton2 then
											task.wait(0.5)
											SafeClick(confirmButton2, 0.1)
										end
									end
								end
							end
						end
						
						wait(1)
						if spawn1 ~= nil then
							plr.Character.HumanoidRootPart:PivotTo(spawn1)
						end

						debounce = false
					end
				end)
			end)
		end,
	})
	
	
	-- ==========================================
	-- AUTO START
	-- ==========================================
	local ToggleAutoStart = TabMain:CreateToggle({
		Name = "üé£ Auto Start (Lan√ßar Vara)",
		CurrentValue = false,
		Flag = "AutoStart",
		Callback = function(Value)
			ActiveStates.autoStart = Value

			if Connections.autoStart then
				SafeDisconnect(Connections.autoStart)
				Connections.autoStart = nil
			end

			if not Value then
				print("‚ùå Auto Start DESATIVADO")
				Notify("Auto Start", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Start ATIVADO")
			Notify("Auto Start", "Ativado!", 2)

			local debounce = false

			Connections.autoStart = RunService.Heartbeat:Connect(function()
				if not ActiveStates.autoStart or debounce then return end

				pcall(function()
					local Bobbers = Workspace:FindFirstChild("Bobbers")
					if not Bobbers then return end

					local character = Workspace.Characters:FindFirstChild(plr.Name)
					if not character or not character:FindFirstChild('Fishing Rod') then return end

					local bobberName = plr.UserId .. ".bobber"
					if Bobbers:FindFirstChild(bobberName) then return end

					debounce = true

					VIM:SendMouseButtonEvent(0, 0, 0, true, game, 0)
					task.wait(Config.autoStartDelay)
					VIM:SendMouseButtonEvent(0, 0, 0, false, game, 0)

					task.wait(1)
					debounce = false
				end)
			end)
		end,
	})

	-- ==========================================
	-- AUTO CAPTURA
	-- ==========================================
	local ToggleAutoCaptura = TabMain:CreateToggle({
		Name = "üêü Auto Captura (Pegar Peixe)",
		CurrentValue = false,
		Flag = "AutoCaptura",
		Callback = function(Value)
			ActiveStates.autoCaptura = Value

			if Connections.autoCaptura then
				SafeDisconnect(Connections.autoCaptura)
				Connections.autoCaptura = nil
			end

			if not Value then
				print("‚ùå Auto Captura DESATIVADO")
				Notify("Auto Captura", "Desativado", 2)
				return
			end

			print("‚úÖ Auto Captura ATIVADO")
			Notify("Auto Captura", "Ativado!", 2)

			local debounce = false

			Connections.autoCaptura = RunService.Heartbeat:Connect(function()
				if not ActiveStates.autoCaptura or debounce then return end

				pcall(function()
					local CatchUI = plr.PlayerGui:FindFirstChild("CatchOrReleaseIndicator")
					if not CatchUI then return end

					if not CatchUI:FindFirstChild('Frame') then return end

					for _, v in pairs(CatchUI:GetDescendants()) do
						if not ActiveStates.autoCaptura then break end

						if v:IsA('TextButton') and v.Name == 'TextButton' and v.Text == "Catch" and v.Visible then
							debounce = true

							task.wait(Config.autoCaptureDelay)

							if not ActiveStates.autoCaptura then
								debounce = false
								break
							end

							if SafeClick(v, 0.1) then
								Stats.totalCatches = Stats.totalCatches + 1
								Stats.lastCatch = tick()
							end

							task.wait(0.5)
							debounce = false
							break
						end
					end
				end)
			end)
		end,
	})

	-- ==========================================
	-- ABA TELEPORTE
	-- ==========================================

	local SectionTeleport = TabTeleport:CreateSection("Locais R√°pidos")

	local locations = {
		{name = "üè† Centro", position = CFrame.new(5104.85, 195.32, -50.36)},
		{name = "üï≥Ô∏è Caverna", position = CFrame.new(5325.29, 22.98, -531.40)},
		{name = "ü¶à Pescador", position = Workspace.NPCS.Fisherman.UpperTorso.CFrame},
		{name = "üìà Quest Giver", position = Workspace.NPCS["Quest Giver"].UpperTorso.CFrame},
	}

	for _, location in ipairs(locations) do
		TabTeleport:CreateButton({
			Name = location.name,
			Callback = function()
				pcall(function()
					if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
						plr.Character.HumanoidRootPart:PivotTo(location.position)
						Notify("Teleporte", "Teleportado para " .. location.name, 2)
					else
						Notify("Erro", "Personagem n√£o encontrado!", 3)
					end
				end)
			end,
		})
	end
	
	
	TabTeleport:CreateButton({
		Name = "Set Spawn",
		Callback = function()
			pcall(function()
				if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					spawn1 = plr.Character.HumanoidRootPart.CFrame
					Notify("Teleporte", "Custom spawn setado", 2)
				else
					Notify("Erro", "Personagem n√£o encontrado!", 3)
				end
			end)
		end,
	})

	-- ==========================================
	-- ABA ESTAT√çSTICAS
	-- ==========================================

	local SectionStats = TabStats:CreateSection("Estat√≠sticas da Sess√£o")

	local LabelCatches = TabStats:CreateLabel("Total de Capturas: 0")
	local LabelTime = TabStats:CreateLabel("Tempo de Sess√£o: 0m")
	local LabelRate = TabStats:CreateLabel("Taxa: 0 peixes/hora")

	task.spawn(function()
		while task.wait(1) do
			pcall(function()
				local sessionTime = tick() - Stats.sessionStart
				local minutes = math.floor(sessionTime / 60)
				local rate = Stats.totalCatches > 0 and (Stats.totalCatches / (sessionTime / 3600)) or 0

				LabelCatches:Set("Total de Capturas: " .. Stats.totalCatches)
				LabelTime:Set(string.format("Tempo de Sess√£o: %dm", minutes))
				LabelRate:Set(string.format("Taxa: %.1f peixes/hora", rate))
			end)
		end
	end)

	TabStats:CreateButton({
		Name = "üîÑ Resetar Estat√≠sticas",
		Callback = function()
			Stats.totalCatches = 0
			Stats.sessionStart = tick()
			Stats.lastCatch = 0
			Notify("Estat√≠sticas", "Resetadas com sucesso!", 2)
		end,
	})

	-- ==========================================
	-- ABA CONFIGURA√á√ïES
	-- ==========================================

	local SectionConfig = TabSettings:CreateSection("Ajustes Avan√ßados")

	TabSettings:CreateSlider({
		Name = "‚è±Ô∏è Delay Auto Click (s)",
		Range = {0.1, 1},
		Increment = 0.1,
		CurrentValue = Config.autoClickDelay,
		Flag = "AutoClickDelay",
		Callback = function(Value)
			Config.autoClickDelay = Value
		end,
	})

	TabSettings:CreateSlider({
		Name = "üéØ Precis√£o Complete (%)",
		Range = {0.001, 0.01},
		Increment = 0.001,
		CurrentValue = Config.autoCompleteThreshold,
		Flag = "AutoCompleteThreshold",
		Callback = function(Value)
			Config.autoCompleteThreshold = Value
		end,
	})

	local SectionUtility = TabSettings:CreateSection("Utilidades")

	TabSettings:CreateToggle({
		Name = "üõ°Ô∏è Anti-AFK",
		CurrentValue = false,
		Flag = "AntiAFK",
		Callback = function(Value)
			ActiveStates.antiAfk = Value

			if Connections.antiAfk then
				SafeDisconnect(Connections.antiAfk)
				Connections.antiAfk = nil
			end

			if not Value then
				print("‚ùå Anti-AFK DESATIVADO")
				Notify("Anti-AFK", "Desativado", 2)
				return
			end

			print("‚úÖ Anti-AFK ATIVADO")
			Notify("Anti-AFK", "Ativado!", 2)

			local lastMove = tick()
			Connections.antiAfk = RunService.Heartbeat:Connect(function()
				if not ActiveStates.antiAfk then return end

				if tick() - lastMove >= 300 then
					pcall(function()
						VIM:SendKeyEvent(true, Enum.KeyCode.W, false, game)
						task.wait(0.01)
						VIM:SendKeyEvent(false, Enum.KeyCode.W, false, game)
					end)
					lastMove = tick()
				end
			end)
		end,
	})

	TabSettings:CreateButton({
		Name = "üõë DESLIGAR TUDO",
		Callback = function()
			ActiveStates.autoClick = false
			ActiveStates.autoComplete = false
			ActiveStates.autoStart = false
			ActiveStates.autoCaptura = false
			ActiveStates.autoRepair = false
			ActiveStates.antiAfk = false

			ClearConnectionTable(Connections.autoClick)
			SafeDisconnect(Connections.autoComplete)
			SafeDisconnect(Connections.autoStart)
			SafeDisconnect(Connections.autoCaptura)
			SafeDisconnect(Connections.autoRepair)
			SafeDisconnect(Connections.antiAfk)

			Connections.autoComplete = nil
			Connections.autoStart = nil
			Connections.autoCaptura = nil
			Connections.autoRepair = nil
			Connections.antiAfk = nil

			ToggleAutoClick:Set(false)
			ToggleAutoComplete:Set(false)
			ToggleAutoStart:Set(false)
			ToggleAutoCaptura:Set(false)
			ToggleAutoRepair:Set(false)

			Notify("Sistema", "üõë Todas as fun√ß√µes foram desligadas!", 3)
			print("üõë TUDO DESLIGADO!")
		end,
	})

	-- ==========================================
	-- MONITORAMENTO DE COMPRA DE GAMEPASS
	-- ==========================================
	if GAMEPASS_ID > 0 then
		MarketplaceService.PromptGamePassPurchaseFinished:Connect(function(player, gamePassId, wasPurchased)
			if player == plr and gamePassId == GAMEPASS_ID and wasPurchased then
				print("[GamePass] ‚úÖ GamePass comprada! Atualizando status...")
				Notify("GamePass", "‚úÖ Compra confirmada! Acesso autorizado!", 5)
			end
		end)
	end

	-- ==========================================
	-- INICIALIZA√á√ÉO
	-- ==========================================

	Notify("Mushyo Pro", "‚úÖ Script Premium carregado com sucesso!", 4)
	print("üê† Mushyo Pro v3.0 - Premium Edition")
	print(string.format("‚úÖ Autorizado: %s (UserID: %d)", plr.Name, plr.UserId))
end

-- ==========================================
-- EXECU√á√ÉO PRINCIPAL
-- ==========================================
local plr = Players.LocalPlayer

-- Inicializa verifica√ß√£o
local authorized = initializeAuth(plr)

if authorized then
	-- Se j√° est√° autorizado, carrega o script principal
	loadMainScript()
else
	-- Se n√£o est√° autorizado, mostra a tela e espera a√ß√£o do usu√°rio
	print("[SCRIPT] ‚è≥ Aguardando a√ß√£o do usu√°rio...")

	-- Monitora compra de GamePass em segundo plano (apenas se tiver GamePass)
	if GAMEPASS_ID > 0 then
		MarketplaceService.PromptGamePassPurchaseFinished:Connect(function(player, gamePassId, wasPurchased)
			if player == plr and gamePassId == GAMEPASS_ID and wasPurchased and not stopChecking then
				print("[GamePass] ‚úÖ GamePass comprada! Verificando novamente...")
				task.wait(1)

				local authorized, authType = checkUserAuthorization(plr.UserId)
				if authorized then
					print(string.format("[AUTH] ‚úÖ %s agora est√° autorizado via %s!", plr.Name, authType))
					isAuthorized = true
					waitingForPermission = false

					-- Remove tela de bloqueio
					local unauthorizedScreen = plr.PlayerGui:FindFirstChild("UnauthorizedScreen")
					if unauthorizedScreen then
						unauthorizedScreen:Destroy()
					end

					-- Inicia o script principal
					loadMainScript()
					print("[SCRIPT] ‚úÖ Script principal carregado ap√≥s compra!")
				end
			end
		end)
	end

	-- Informa que est√° aguardando
	warn("[SCRIPT] ‚è≥ Script pausado - Aguardando autoriza√ß√£o do usu√°rio")
end
